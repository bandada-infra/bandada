# This docker file is for running the app in a local environment
# Envs for api are set directly in this file
# The dashboard and client will be built to point to "localhost" api

version: "3.9"

services:
    api:
        container_name: api
        build:
            context: ./
            dockerfile: ./apps/api/Dockerfile
            args:
                - BUILD_LOCAL=true
        image: bandada-api:latest
        restart: unless-stopped
        environment:
            - DB_URL=postgres://root:helloworld@postgres:5432/bandada
            - DB_TYPE=postgres
            - INFURA_API_KEY=
            - IRON_SESSION_PASSWORD=JJ1EnoEPyesNnpdcDVD4ujVG2XKXJLQx
            - BACKEND_PRIVATE_KEY=ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
            - ETHEREUM_NETWORK=localhost
            - API_URL=http://localhost:3000
            - DASHBOARD_URL=http://localhost:3001
            - SIWE_STATEMENT=You are using your Ethereum Wallet to sign in to Bandada.
        ports:
            - "3000:3000"
        networks:
            - bandada

    client:
        container_name: client
        build:
            context: ./
            dockerfile: ./apps/client/Dockerfile
            args:
                - BUILD_LOCAL=true
        image: bandada-client:latest
        restart: unless-stopped
        environment:
            - NODE_ENV=production
        ports:
            - "3002:80"
        networks:
            - bandada
        depends_on:
            - api

    dashboard:
        container_name: dashboard
        build:
            context: ./
            dockerfile: ./apps/dashboard/Dockerfile
        image: bandada-dashboard:latest
        restart: unless-stopped
        environment:
            - NODE_ENV=production
        ports:
            - "3001:80"
        networks:
            - bandada
        depends_on:
            - api

    postgres:
        container_name: postgres
        image: postgres
        environment:
            POSTGRES_USER: root
            POSTGRES_PASSWORD: helloworld
            POSTGRES_DB: bandada
            PGDATA: /data/postgres
        volumes:
            - pgdb:/data/postgres
            - ./database/seed.sql:/docker-entrypoint-initdb.d/1-schema.sql
        ports:
            - "5432:5432"
        restart: unless-stopped
        command: postgres -c listen_addresses='*'
        networks:
            - bandada

networks:
    bandada:
        internal: false
        driver: bridge

volumes:
    pgdb:
